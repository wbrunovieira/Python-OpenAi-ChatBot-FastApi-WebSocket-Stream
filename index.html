<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <title>WB Digital Solutions Assistente ðŸ¤“</title>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <script src="https://unpkg.com/react@latest/umd/react.development.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@latest/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@babel/standalone@latest/babel.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <style>
        body {
            background-color: #792990; /* Cor de fundo do body */
            color: #fff; /* Cor do texto do body */
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const {
            colors,
            CssBaseline,
            ThemeProvider,
            Typography,
            TextField,
            Container,
            createTheme,
            Box,
            Skeleton,
        } = MaterialUI;

        const theme = createTheme({
            palette: {
                primary: {
                    main: '#350545', // Sua cor primÃ¡ria personalizada
                },
                secondary: {
                    main: '#FFB937', // Sua cor secundÃ¡ria personalizada
                },
                background: {
                default: '#792990', // Cor de fundo personalizada
                paper: '#ffffff', // Cor de fundo para componentes 'paper'
                },
                text: {
                    primary: '#fff', // Cor do texto primÃ¡ria
                    secondary: '#FFB937', // Cor do texto secundÃ¡ria
                },
                // ... outras definiÃ§Ãµes de paleta
            },
            
    // ... outras configuraÃ§Ãµes do tema
});
    
   
        const WS = new WebSocket("ws://localhost:8000/ws");
        

        function App() {
            const [response, setResponse] = React.useState("");
            const [question, setQuestion] = React.useState("");
            const [loading, setLoading] = React.useState(false);
            const [WS, setWS] = React.useState(null);

            React.useEffect(() => {
    const newWS = new WebSocket("ws://localhost:8000/ws");

    newWS.onopen = () => {
        console.log("WebSocket conectado.");
        newWS.send("OlÃ¡, obrigado por vir conversar comigo! Como posso te ajudar?");
    };

    newWS.onmessage = (event) => {
        setLoading(false);
        setResponse(marked.parse(event.data));
    };

    newWS.onclose = () => {
        console.log("WebSocket desconectado. Tentando reconectar...");
        setTimeout(() => setWS(null), 3000); // Tenta reconectar apÃ³s 3 segundos.
    };

    setWS((prevWS) => {
        if (prevWS) {
            prevWS.close();
        }
        return newWS;
    });

    return () => {
        newWS.close();
    };
}, []); // Remova [WS] da lista de dependÃªncias


            return (
                <Container maxWidth="lg">
                    <Box sx={{ my: 4 }}>
                        <Typography variant="h4" component="h1" gutterBottom>
                            Assistente WB Digital Solutions ðŸ¤“
                        </Typography>
                        <TextField
                            id="outlined-basic"
                            label="Me pergunte algo sobre o WB Digital Solutions"
                            variant="outlined"
                            style={{ 
                                width: '100%', 
                                backgroundColor: theme.palette.primary.main, 
                                color: theme.palette.secondary.main 
                                }}
                                InputProps={{
                                    style: {
                                        color: theme.palette.secondary.main // Cor do texto
                                    }
                                }}
                                value={question}
                            disabled={loading}
                                                sx={{
                            '& label.Mui-focused': {
                                color: theme.palette.primary.main,
                            },
                            '& .MuiOutlinedInput-root': {
                                '&.Mui-focused fieldset': {
                                    borderColor: theme.palette.primary.main,
                                },
                            },
                        }}
                            onChange={e => {
                                setQuestion(e.target.value)
                            }}
                            onKeyUp={e => {
                                setLoading(false)
                                if (e.key === "Enter") {
                                    setResponse('')
                                    setLoading(true)
                                    WS.send(question);
                                }
                            }}
                        />
                    </Box>
                    {!response && loading && (<>
                        <Skeleton />
                        <Skeleton animation="wave" />
                        <Skeleton animation={false} /></>)}
                    {response && <Typography dangerouslySetInnerHTML={{ __html: response }} />}
                </Container>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(
            <ThemeProvider theme={theme}>
                <CssBaseline />
                <App />
            </ThemeProvider>,
        );
    </script>
</body>

</html>